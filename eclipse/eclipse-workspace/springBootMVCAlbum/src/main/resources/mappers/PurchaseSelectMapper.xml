<!DOCTYPE mapper PUBLIC
	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="springBootMVCAlbum.mapper.PurchaseSelectMapper">

	<resultMap type="orderListDTO" id="orderListResultMap">
	<association property="deliveryDTO">
		<id column="purchase_Num" jdbcType="VARCHAR" property="purchaseNum"/>
		<result column="delivery_num" jdbcType="VARCHAR" property="deliveryNum" />
		<result column="delivery_date" jdbcType="DATE" property="deliveryDate"/>
		<result column="delivery_status" jdbcType="VARCHAR" property="deliveryStatus"/>
	</association>
	<association property="purchaseDTO" javaType="purchaseDTO">
		<constructor>
			<idArg column="purchase_Num" javaType="string" />
			<arg column="purchase_Date" javaType="java.util.Date"/>
			<arg column="purchase_Price" javaType="integer"/>
			<arg column="delivery_Addr" javaType="string"/>
			<arg column="delivery_Addr_Detail" javaType="string"/>
			<arg column="delivery_Post" javaType="string"/>
			<arg column="delivery_Phone" javaType="string"/>
			<arg column="message" javaType="string"/>
			<arg column="purchase_Status" javaType="string"/>
			<arg column="member_num" javaType="string"/>
			<arg column="delivery_name" javaType="string"/>
			<arg column="purchase_Name" javaType="string"/>		
		</constructor>
	</association>
	<association property="paymentDTO" javaType="paymentDTO">
		<id column="purchase_Num" jdbcType="VARCHAR" property="purchaseNum"/>
		<result column="confirmnumber" jdbcType="VARCHAR" property="confirmnumber"/>
		<result property="appldate" column="appldate" jdbcType="VARCHAR" />
		<result property="appltime" column="appltime" jdbcType="VARCHAR" />
		<result property="totalprice" column="totalprice" jdbcType="BIGINT" />
		<result property="cardnum" column="cardnum" jdbcType="VARCHAR" />
	</association>
	<collection property="purchaseListGoodsDTO" ofType="purchaseListGoodsDTO">
		<association property="purchaseListDTO" javaType="purchaseListDTO">
			<result column="purchase_qty" jdbcType="BIGINT" property="purchaseQty"/>
			<result column="PURCHASE_PRICE" jdbcType="BIGINT" property="totalPrice"/>
		</association>
		<association property="goodsDTO" javaType="goodsDTO">
			<id column="goods_Num" jdbcType="VARCHAR" property="goodsNum"/>
			<result column="goods_contents" jdbcType="VARCHAR" property="goodsContents"/>
			<result column="goods_name" jdbcType="VARCHAR" property="goodsName"/>
			<result column="GOODS_MAIN_STORE_IMAGE" jdbcType="VARCHAR" property="goodsMainStoreImage"/>
		</association>
		<association property="reviewDTO" javaType="reviewDTO">
			<result column="review_Date" jdbcType="DATE" property="reviewDate"/>
			<result column="review_Contents" jdbcType="VARCHAR" property="reviewContents"/>
			<result column="member_Id" jdbcType="VARCHAR" property="memberId"/>
		</association>
	</collection>
</resultMap>

<select id="myPurchaseSelect" parameterType="string" resultMap="orderListResultMap">
select p.PURCHASE_NUM, p.PURCHASE_DATE, p.PURCHASE_PRICE, p.DELIVERY_ADDR, p.DELIVERY_ADDR_DETAIL, p.DELIVERY_POST
, p.DELIVERY_PHONE, p.MESSAGE, p.PURCHASE_STATUS, p.MEMBER_NUM, p.DELIVERY_NAME, p.PURCHASE_NAME
,pl.GOODS_NUM, pl.PURCHASE_NUM, pl.PURCHASE_QTY, pl.PURCHASE_PRICE
,g.GOODS_NUM, g.GOODS_NAME, g.GOODS_MAIN_STORE_IMAGE
,pm.PURCHASE_NUM, pm.CONFIRMNUMBER, pm.TOTALPRICE, pm.PAYMETHOD
,d.PURCHASE_NUM, d.DELIVERY_NUM, d.DELIVERY_DATE, d.DELIVERY_STATUS
from purchase p
join purchase_list pl on p.PURCHASE_NUM = pl.PURCHASE_NUM
join goods g on pl.goods_num = g.goods_num
join payment pm on pl.purchase_num = pm.purchase_num
left outer join delivery d on pl.purchase_num = d.purchase_num
where p.MEMBER_NUM = #{memberNum}
</select>

<select id="PurchaseSelectAll" resultMap="orderListResultMap">
select p.PURCHASE_NUM, p.PURCHASE_DATE, p.PURCHASE_PRICE, p.DELIVERY_ADDR, p.DELIVERY_ADDR_DETAIL, p.DELIVERY_POST
, p.DELIVERY_PHONE, p.MESSAGE, p.PURCHASE_STATUS, p.MEMBER_NUM, p.DELIVERY_NAME, p.PURCHASE_NAME
,pl.GOODS_NUM, pl.PURCHASE_NUM, pl.PURCHASE_QTY, pl.PURCHASE_PRICE
,g.GOODS_NUM, g.GOODS_NAME, g.GOODS_MAIN_STORE_IMAGE
,pm.PURCHASE_NUM, pm.CONFIRMNUMBER, pm.TOTALPRICE, pm.PAYMETHOD
,d.PURCHASE_NUM, d.DELIVERY_NUM, d.DELIVERY_DATE, d.DELIVERY_STATUS
from purchase p
join purchase_list pl on p.PURCHASE_NUM = pl.PURCHASE_NUM
join goods g on pl.goods_num = g.goods_num
join payment pm on pl.purchase_num = pm.purchase_num
left outer join delivery d on pl.purchase_num = d.purchase_num
</select>

</mapper>